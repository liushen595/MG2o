# MG2O è‹å·å¤§å­¦åšç‰©é¦†æ™ºèƒ½è¯­éŸ³åŠ©æ‰‹å°ç¨‹åº

åŸºäºå°æ™ºå¼€æºé¡¹ç›®çš„å¾®ä¿¡å°ç¨‹åºç‰ˆæ™ºèƒ½è¯­éŸ³åŠ©æ‰‹ï¼Œç»è¿‡å®šåˆ¶åŒ–å¼€å‘ï¼Œä¸“é—¨ç”¨äºä»‹ç»è‹å·å¤§å­¦åšç‰©é¦†ï¼Œæä¾›è¯­éŸ³äº¤äº’ã€TTSæ–‡æœ¬è½¬è¯­éŸ³ä»¥åŠå¤§æ¨¡å‹é—®ç­”åŠŸèƒ½ã€‚åç«¯æœåŠ¡ç»è¿‡ç‰¹æ®Šä¿®æ”¹ï¼Œèå…¥äº†è‹å·å¤§å­¦åšç‰©é¦†çš„ä¸“ä¸šçŸ¥è¯†åº“ã€‚

## ğŸ“š é¡¹ç›®æ–‡æ¡£

- **[æ¶æ„æ–‡æ¡£](docs/architecture.md)** - é¡¹ç›®æ¶æ„è¯¦è§£ã€ç»„ä»¶è¯´æ˜ã€æ•°æ®æµåˆ†æ
- **[æŠ€æœ¯è¯¦è§£](docs/CSDN.md)** - æ ¸å¿ƒæŠ€æœ¯å®ç°è¯´æ˜ä¸ä»£ç è§£æ

## ğŸ›ï¸ é¡¹ç›®ç‰¹è‰²

è¯¥é¡¹ç›®é‡‡ç”¨äº†ç°ä»£åŒ–çš„æ¨¡å—åŒ–æ¶æ„ï¼Œé€šè¿‡ Vue 3 Composition API å’Œ uni-app æ¡†æ¶æ„å»ºï¼Œå…·æœ‰è‰¯å¥½çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚æ ¸å¿ƒç‰¹ç‚¹åŒ…æ‹¬ï¼š

- **æ¨¡å—åŒ–æ¶æ„**: ä½¿ç”¨ composables è¿›è¡Œé€»è¾‘å¤ç”¨ï¼Œç»„ä»¶åŒ– UI å¼€å‘
- **å“åº”å¼çŠ¶æ€ç®¡ç†**: åŸºäº Vue 3 å“åº”å¼ç³»ç»Ÿçš„çŠ¶æ€åŒæ­¥
- **å®æ—¶é€šä¿¡**: WebSocket è¿æ¥ç®¡ç†ä¸æ¶ˆæ¯å¤„ç†
- **æ™ºèƒ½è¯­éŸ³äº¤äº’**: é›†æˆ STT/TTS å’Œå¤§æ¨¡å‹é—®ç­”

## ğŸ“ é¡¹ç›®ç»“æ„

```
mg2o/
â”œâ”€â”€ App.vue                      # åº”ç”¨å…¥å£æ–‡ä»¶
â”œâ”€â”€ index.html                   # HTMLå…¥å£æ–‡ä»¶
â”œâ”€â”€ main.js                      # ä¸»JSæ–‡ä»¶
â”œâ”€â”€ manifest.json                # å°ç¨‹åºé…ç½®æ–‡ä»¶
â”œâ”€â”€ pages.json                   # é¡µé¢é…ç½®
â”œâ”€â”€ uni.scss                     # å…¨å±€æ ·å¼
â”œâ”€â”€ components/                  # UIç»„ä»¶
â”‚   â””â”€â”€ home/                    # é¦–é¡µç›¸å…³ç»„ä»¶
â”‚       â”œâ”€â”€ AudioVisualizer.vue     # éŸ³é¢‘å¯è§†åŒ–ç»„ä»¶
â”‚       â”œâ”€â”€ LocationVerification.vue # ä½ç½®éªŒè¯ç»„ä»¶
â”‚       â”œâ”€â”€ MessageInput.vue        # æ¶ˆæ¯è¾“å…¥ç»„ä»¶
â”‚       â”œâ”€â”€ MessageList.vue         # æ¶ˆæ¯åˆ—è¡¨ç»„ä»¶
â”‚       â”œâ”€â”€ SideDrawer.vue          # ä¾§è¾¹æ ç»„ä»¶
â”‚       â”œâ”€â”€ SpeechRecognition.vue   # è¯­éŸ³è¯†åˆ«ç»“æœç»„ä»¶
â”‚       â””â”€â”€ TopNavBar.vue           # é¡¶éƒ¨å¯¼èˆªæ ç»„ä»¶
â”œâ”€â”€ composables/                 # å¯å¤ç”¨é€»è¾‘
â”‚   â”œâ”€â”€ useGlobalSettings.js     # å…¨å±€è®¾ç½®
â”‚   â””â”€â”€ home/                    # é¦–é¡µç›¸å…³é€»è¾‘
â”‚       â”œâ”€â”€ useConnection.js     # è¿æ¥ç®¡ç†
â”‚       â”œâ”€â”€ useMessages.js       # æ¶ˆæ¯å¤„ç†
â”‚       â”œâ”€â”€ useAudioRecording.js # éŸ³é¢‘å½•åˆ¶
â”‚       â”œâ”€â”€ useLocation.js       # ä½ç½®éªŒè¯é€»è¾‘
â”‚       â”œâ”€â”€ useLogger.js         # æ—¥å¿—è®°å½•
â”‚       â””â”€â”€ useNavigation.js     # å¯¼èˆªç®¡ç†
â”œâ”€â”€ pages/                       # é¡µé¢ç›®å½•
â”‚   â”œâ”€â”€ about/                   # å…³äºé¡µé¢
â”‚   â”‚   â””â”€â”€ about.vue
â”‚   â”œâ”€â”€ index/                   # ä¸»é¡µ
â”‚   â”‚   â””â”€â”€ index.vue            # ä¸»é¡µè§†å›¾
â”‚   â”œâ”€â”€ location/                # ä½ç½®éªŒè¯é¡µé¢
â”‚   â”‚   â””â”€â”€ location.vue
â”‚   â”œâ”€â”€ settings/                # è®¾ç½®é¡µé¢
â”‚   â”‚   â””â”€â”€ settings.vue
â”‚   â””â”€â”€ share/                   # åˆ†äº«é¡µé¢
â”‚       â””â”€â”€ share.vue
â”œâ”€â”€ utils/                       # å·¥å…·ç±»
â”‚   â”œâ”€â”€ location-service.js      # ä½ç½®æœåŠ¡
â”‚   â””â”€â”€ xiaozhi-service.js       # å°æ™ºè¯­éŸ³äº¤äº’æœåŠ¡
â”œâ”€â”€ static/                      # é™æ€èµ„æº
â”‚   â”œâ”€â”€ logo.png
â”‚   â”œâ”€â”€ wx.png                   # å¾®ä¿¡äºŒç»´ç 
â”‚   â””â”€â”€ äºŒç»´ç .jpg
â””â”€â”€ docs/                        # é¡¹ç›®æ–‡æ¡£
    â”œâ”€â”€ architecture.md          # æ¶æ„æ–‡æ¡£
    â”œâ”€â”€ CSDN.md                  # æŠ€æœ¯è¯¦è§£
    â””â”€â”€ development-guidelines.md # å¼€å‘è§„èŒƒ
```

## âœ¨ ç‰¹ç‚¹

- **è¯­éŸ³è¯†åˆ«(STT)**: æ”¯æŒå°†ç”¨æˆ·è¯­éŸ³å®æ—¶è½¬æ¢ä¸ºæ–‡æœ¬ï¼Œæ–¹ä¾¿è¯­éŸ³è¾“å…¥å’Œæ§åˆ¶ã€‚
- **æ–‡æœ¬è½¬è¯­éŸ³(TTS)**: å°†æ–‡æœ¬å†…å®¹è½¬åŒ–ä¸ºè‡ªç„¶æµç•…çš„è¯­éŸ³æ’­æ”¾ã€‚
- **å¤§æ¨¡å‹é›†æˆ**: æ¥å…¥å¤§è¯­è¨€æ¨¡å‹ï¼Œå®ç°è‡ªç„¶çš„å¯¹è¯äº¤äº’å’Œé—®ç­”åŠŸèƒ½ã€‚
- **åšç‰©é¦†çŸ¥è¯†åº“**: åç«¯é›†æˆè‹å·å¤§å­¦åšç‰©é¦†ä¸“ä¸šçŸ¥è¯†åº“ï¼Œèƒ½å¤Ÿå›ç­”å…³äºé¦†è—æ–‡ç‰©ã€å†å²èƒŒæ™¯ç­‰ä¸“ä¸šé—®é¢˜ã€‚
- **å®šåˆ¶åŒ–å¯¼è§ˆä½“éªŒ**: æä¾›åšç‰©é¦†ä¸“ä¸šå¯¼è§ˆæœåŠ¡ï¼Œæ ¹æ®ç”¨æˆ·æ‰€å¤„ä½ç½®æä¾›ç›¸å…³å±•å“ä¿¡æ¯ã€‚
- **WebSocketé€šä¿¡**: é€šè¿‡WebSocketå®ç°ä¸åç«¯æœåŠ¡å™¨çš„å®æ—¶åŒå‘é€šä¿¡ã€‚
- **éŸ³é¢‘æµå¼å¤„ç†**: æ”¯æŒéŸ³é¢‘æµå¤„ç†ï¼Œå®ç°è¯­éŸ³çš„å®æ—¶æ’­æ”¾ã€‚
- **åœ°ç†ä½ç½®æ„ŸçŸ¥**: åœ¨è‹å·å¤§å­¦å¤©èµåº„æ ¡åŒºåšç‰©é¦†èŒƒå›´å†…æä¾›åŸºäºä½ç½®çš„ç²¾å‡†æœåŠ¡ã€‚
- **æ¨¡å—åŒ–æ¶æ„**: é‡‡ç”¨ Vue 3 Composition API å®ç°é€»è¾‘å¤ç”¨å’ŒçŠ¶æ€ç®¡ç†ä¼˜åŒ–ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: uni-app (åŸºäº Vue 3)
- **ç»„åˆå¼API**: Vue 3 Composition API
- **è¿è¡Œç¯å¢ƒ**: å¾®ä¿¡å°ç¨‹åº
- **é€šä¿¡åè®®**: WebSocket
- **éŸ³é¢‘æ ¼å¼**: MP3
- **çŠ¶æ€ç®¡ç†**: Vue 3 å“åº”å¼ç³»ç»Ÿ
- **æ¶æ„æ¨¡å¼**: ç»„ä»¶åŒ– + Composables

## ğŸ”§ åŠŸèƒ½æ¨¡å—

### Core Services

#### xiaozhi-service.js
æä¾›ä¸å°æ™ºè¯­éŸ³æœåŠ¡å™¨äº¤äº’çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå·²é’ˆå¯¹è‹å·å¤§å­¦åšç‰©é¦†è¿›è¡Œå®šåˆ¶åŒ–ä¿®æ”¹ï¼ŒåŒ…æ‹¬ï¼š
- WebSocketè¿æ¥ç®¡ç†
- è¯­éŸ³å½•åˆ¶å’Œå‘é€
- æ–‡æœ¬æ¶ˆæ¯å‘é€
- TTSè¯­éŸ³æ’­æ”¾ä¸åšç‰©é¦†è®²è§£å†…å®¹
- éŸ³é¢‘é˜Ÿåˆ—ç®¡ç†
- åšç‰©é¦†ä¸“ä¸šçŸ¥è¯†é—®ç­”

#### location-service.js
æä¾›ä½ç½®æœåŠ¡åŠŸèƒ½ï¼Œç”¨äºè·å–ç”¨æˆ·åœ¨åšç‰©é¦†å†…çš„ç²¾ç¡®ä½ç½®ï¼Œè‡ªåŠ¨æ¨é€ç›¸å…³å±•å“ä¿¡æ¯ã€‚

### Composables (ç»„åˆå¼å‡½æ•°)

- **useConnection.js**: ç®¡ç† WebSocket è¿æ¥çŠ¶æ€å’ŒåŒæ­¥
- **useMessages.js**: å¤„ç†æ¶ˆæ¯å‘é€ã€æ¥æ”¶å’Œå†å²è®°å½•
- **useAudioRecording.js**: ç®¡ç†éŸ³é¢‘å½•åˆ¶å’Œè¯­éŸ³è¯†åˆ«
- **useNavigation.js**: å¤„ç†é¡µé¢å¯¼èˆªå’Œä¾§è¾¹æ çŠ¶æ€
- **useLogger.js**: ç»Ÿä¸€æ—¥å¿—è®°å½•å’Œè°ƒè¯•

### Components (UIç»„ä»¶)

- **MessageInput.vue**: æ¶ˆæ¯è¾“å…¥ç»„ä»¶ï¼ˆæ”¯æŒæ–‡æœ¬å’Œè¯­éŸ³ï¼‰
- **MessageList.vue**: æ¶ˆæ¯åˆ—è¡¨æ˜¾ç¤ºç»„ä»¶
- **TopNavBar.vue**: é¡¶éƒ¨å¯¼èˆªæ 
- **SideDrawer.vue**: ä¾§æ‹‰æŠ½å±‰å¯¼èˆª
- **AudioVisualizer.vue**: å½•éŸ³å¯è§†åŒ–æ•ˆæœ
- **SpeechRecognition.vue**: è¯­éŸ³è¯†åˆ«ç»“æœæ˜¾ç¤º

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿä½“éªŒ
åœ¨è‹å·å¤§å­¦å¤©èµåº„æ ¡åŒº10kmèŒƒå›´å†…æ‰«ç è¯•ç”¨:
![alt text](wx.png)

### å¼€å‘è°ƒç”¨ç¤ºä¾‹

1. **è¿æ¥æœåŠ¡å™¨**ï¼š
```javascript
import xiaozhiService from '@/utils/xiaozhi-service.js';

// è¿æ¥åˆ°è¯­éŸ³æœåŠ¡å™¨
xiaozhiService.connectToServer(
  'ws://your-server-address',
  () => console.log('è¿æ¥æˆåŠŸ'),
  (message) => console.log('æ”¶åˆ°æ¶ˆæ¯', message),
  () => console.log('è¿æ¥å…³é—­'),
  (error) => console.log('é”™è¯¯', error),
  (text) => console.log('è¯­éŸ³è¯†åˆ«ç»“æœ', text)
);
```

2. **å‘é€æ–‡æœ¬æ¶ˆæ¯**ï¼š
```javascript
xiaozhiService.sendTextMessage('ä½ å¥½ï¼Œå°æ™º');
```

3. **è¯­éŸ³äº¤äº’**ï¼š
```javascript
// åˆå§‹åŒ–å½•éŸ³
xiaozhiService.initRecorder(
  () => console.log('å¼€å§‹å½•éŸ³'),
  () => console.log('å½•éŸ³ç»“æŸ'),
  (err) => console.log('å½•éŸ³é”™è¯¯', err)
);

// å¼€å§‹å½•éŸ³
xiaozhiService.startRecording();

// åœæ­¢å½•éŸ³å¹¶å‘é€
xiaozhiService.stopRecordingAndSend()
  .then(() => console.log('è¯­éŸ³å‘é€æˆåŠŸ'))
  .catch(err => console.log('è¯­éŸ³å‘é€å¤±è´¥', err));
```

### ä½¿ç”¨ Composables

```javascript
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è¿æ¥ç®¡ç†
import useConnection from '@/composables/home/useConnection.js';

export default {
  setup() {
    const { isConnected, connectionStatusText, reconnectServer } = useConnection();
    
    return {
      isConnected,
      connectionStatusText,
      reconnectServer
    };
  }
};
```

## å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯å¼€æºï¼š
- åç«¯æœåŠ¡åŸºäºå°æ™ºå¼€æºé¡¹ç›®(MITåè®®)ä¿®æ”¹ï¼Œå·²é’ˆå¯¹è‹å·å¤§å­¦åšç‰©é¦†çŸ¥è¯†åº“è¿›è¡Œæ·±åº¦å®šåˆ¶ï¼ŒåŸé¡¹ç›®ç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰
- å¾®ä¿¡å°ç¨‹åºå‰ç«¯ä¸ºåŸåˆ›ï¼Œç‰ˆæƒå½’515æ‰€æœ‰
- è‹å·å¤§å­¦åšç‰©é¦†ç›¸å…³çŸ¥è¯†å†…å®¹çš„ç‰ˆæƒå½’è‹å·å¤§å­¦åšç‰©é¦†æ‰€æœ‰

ä½¿ç”¨æœ¬é¡¹ç›®ä»£ç æ—¶ï¼Œè¯·éµå®ˆMITåè®®çš„ç›¸å…³è§„å®šã€‚å¦‚éœ€ä½¿ç”¨æœ¬é¡¹ç›®ä¸­çš„è‹å·å¤§å­¦åšç‰©é¦†ä¸“ä¸šçŸ¥è¯†å†…å®¹ï¼Œè¯·è”ç³»ç›¸å…³ç‰ˆæƒæ–¹è·å¾—æˆæƒã€‚
